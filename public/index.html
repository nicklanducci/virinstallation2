<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Vertical Live Text</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    @font-face {
      font-family: "InstallationFace";
      src: url("/fonts/YourFont.woff2") format("woff2");
      font-display: swap;
    }

    /* full-bleed black stage */
    html, body { height: 100%; margin: 0; }
    body {
      background: #000; color: #fff;
      font-family: "InstallationFace", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      overflow: hidden;  /* prevent scrollbars */
    }

    /* the “canvas” that holds the text column */
    .stage {
      position: fixed; inset: 0;
      display: grid; place-items: center; /* center horizontally */
    }

    /* the vertical single-line text */
    #out {
      /* make it vertical and bottom-up */
      writing-mode: vertical-rl;     /* vertical column */
      text-orientation: mixed;       /* keep letters upright */
      transform: rotate(180deg);     /* invert so it grows from bottom up */
      transform-origin: center;      /* pivot nicely */
      white-space: nowrap;           /* force a single “line” */
      line-height: 1.05;             /* column density */
      font-size: clamp(28px, 6vw, 120px);
      max-height: 90vh;              /* keep it inside the screen */
      overflow: hidden;
      text-align: center;            /* affects inline alignment in vertical mode */
    }

    /* blinking block cursor at the bottom end */
    .cursor::after {
      content: "▌";
      animation: blink 1s step-end infinite;
      display: inline-block;
      /* cursor flips with the text, no extra transform needed */
    }
    @keyframes blink { 50% { opacity: 0; } }

    /* optional: simple control in the corner for testing */
    .controls {
      position: fixed; left: 1rem; right: 1rem; bottom: 1rem;
      display: flex; gap: .5rem; justify-content: center;
      font-size: 16px; pointer-events: auto;
    }
    input, button {
      background: #111; color: #fff; border: 1px solid #333;
      padding: .6rem .8rem; border-radius: .5rem;
    }
    button { cursor: pointer; }
  </style>
</head>
<body>
  <div class="stage">
    <div id="out" class="cursor"></div>
  </div>

  <!-- optional: quick prompt UI for testing; remove for the art show -->
  <div class="controls">
    <input id="q" placeholder="Type a prompt…" size="40" />
    <button id="go">Stream</button>
  </div>

  <script>
    const out = document.getElementById("out");
    const q   = document.getElementById("q");
    const go  = document.getElementById("go");

    // normalize to keep it one line (strip newlines to spaces)
    const append = (text) => {
      out.textContent += text.replace(/\s*\n+\s*/g, " ");
    };

    function startStream(prompt) {
      out.textContent = "";
      out.classList.add("cursor");

      const es = new EventSource(`/stream?prompt=${encodeURIComponent(prompt)}`);

      // OpenAI named events
      es.addEventListener("response.output_text.delta", (e) => {
        try {
          const msg = JSON.parse(e.data);
          if (typeof msg.delta === "string") append(msg.delta);
        } catch {}
      });

      es.addEventListener("response.completed", () => {
        es.close();
        out.classList.remove("cursor");
      });

      // Fallback handler for generic messages and errors
      es.onmessage = (e) => {
        if (e.data === "[DONE]") { es.close(); out.classList.remove("cursor"); return; }
        try {
          const msg = JSON.parse(e.data);
          if (typeof msg.delta === "string") append(msg.delta);
          if (msg.error) append(`  [error] ${msg.error}`);
        } catch {}
      };

      es.onerror = () => {
        out.classList.remove("cursor");
        append("  [stream error]");
        es.close();
      };
    }

    // boot with a default line; change or remove for your show
    startStream("Give me a single haunting line about the wind.");

    // test UI
    if (go) {
      go.addEventListener("click", () => {
        const prompt = (q.value || "Say hello!").trim();
        startStream(prompt);
        q.blur();
      });
      q.addEventListener("keydown", (e) => {
        if (e.key === "Enter") go.click();
      });
    }
  </script>
</body>
</html>
